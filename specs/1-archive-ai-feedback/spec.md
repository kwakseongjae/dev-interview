# Feature Specification: 아카이브 AI 피드백

**GitHub Issue**: [#1](https://github.com/kwakseongjae/dev-interview/issues/1)
**Plan Document**: [docs/plans/001-archive-keyword-followup-display.md](../../docs/plans/001-archive-keyword-followup-display.md)
**Status**: Implemented
**Created**: 2026-02-05
**Last Updated**: 2026-02-05

---

## 1. Executive Summary

기술면접 준비 서비스(mochabun)의 아카이브 상세 페이지에서 사용자가 작성한 답변에 대해 AI 기반 피드백을 제공하는 기능입니다. 키워드 추출, 점수 평가, 꼬리질문 생성, 강점/개선점 분석을 통해 학습 효과를 높입니다.

### Business Value

- **학습 효과 증대**: 사용자가 자신의 답변에 대한 구체적인 피드백을 받아 개선점 파악
- **추가 학습 유도**: 꼬리질문을 통해 심화 학습 방향 제시
- **서비스 차별화**: AI 피드백 기능으로 경쟁 서비스 대비 가치 제공

---

## 2. User Stories & Acceptance Criteria

### US-1: 답변 키워드 확인 (P1)

**As a** 면접 준비생
**I want to** 내가 작성한 답변에서 핵심 키워드를 확인하고 싶다
**So that** 내 답변이 어떤 개념을 다루고 있는지 한눈에 파악할 수 있다

**Acceptance Criteria**:

- [ ] 각 답변 아래에 3-5개의 키워드가 Badge 형태로 표시된다
- [ ] 키워드는 답변 내용에서 자동으로 추출된다
- [ ] 키워드는 답변 작성 완료 시 즉시 표시된다 (별도 버튼 클릭 불필요)
- [ ] 답변이 없는 질문에는 키워드가 표시되지 않는다

### US-2: 답변 점수 확인 (P1)

**As a** 면접 준비생
**I want to** 내 답변의 점수를 확인하고 싶다
**So that** 답변의 전반적인 품질을 빠르게 파악할 수 있다

**Acceptance Criteria**:

- [ ] 1-5점 척도의 점수가 시각적으로 표시된다
- [ ] 점수에 따라 색상이 다르게 표시된다 (4-5: 초록, 3: 노랑, 1-2: 빨강)
- [ ] 점수 옆에 한 줄 요약 코멘트가 함께 표시된다
- [ ] 점수는 키워드와 함께 즉시 표시된다

### US-3: 꼬리질문 확인 (P1)

**As a** 면접 준비생
**I want to** 내 답변에서 파생될 수 있는 꼬리질문을 확인하고 싶다
**So that** 실제 면접에서 나올 수 있는 심화 질문에 대비할 수 있다

**Acceptance Criteria**:

- [ ] 2-3개의 꼬리질문이 목록 형태로 표시된다
- [ ] 꼬리질문은 원 질문 및 사용자 답변과 관련성이 있다
- [ ] 꼬리질문은 "상세 피드백" 영역에서 확인할 수 있다
- [ ] 꼬리질문을 클릭하면 해당 질문으로 새 면접을 시작할 수 있다 (선택적)

### US-4: 강점/개선점 확인 (P2)

**As a** 면접 준비생
**I want to** 내 답변의 잘한 점과 개선할 점을 확인하고 싶다
**So that** 구체적으로 어떤 부분을 보완해야 하는지 알 수 있다

**Acceptance Criteria**:

- [ ] 잘한 점 2-3개가 목록으로 표시된다
- [ ] 개선점 2-3개가 목록으로 표시된다
- [ ] 각 항목은 구체적이고 실행 가능한 내용이다
- [ ] 강점/개선점은 "상세 피드백" 영역에서 확인할 수 있다

### US-5: 피드백 접기/펼치기 (P1)

**As a** 면접 준비생
**I want to** AI 피드백을 접거나 펼칠 수 있다
**So that** 필요할 때만 상세 정보를 확인하고, 평소에는 간결한 화면을 볼 수 있다

**Acceptance Criteria**:

- [ ] 기본 상태에서는 키워드, 점수, 요약만 표시된다 (Quick Feedback)
- [ ] "펼치기" 버튼을 클릭하면 상세 피드백이 표시된다
- [ ] 펼친 상태에서 "접기" 버튼을 클릭하면 다시 접힌다
- [ ] 펼치기/접기 시 부드러운 애니메이션이 적용된다
- [ ] 펼침 상태는 페이지 새로고침 시 초기화된다

### US-6: 상세 피드백 요청 (P2)

**As a** 면접 준비생
**I want to** 상세한 AI 분석을 요청할 수 있다
**So that** 필요한 경우에만 심층 피드백을 받을 수 있다

**Acceptance Criteria**:

- [ ] 상세 피드백이 아직 생성되지 않은 경우 "상세 분석 요청" 버튼이 표시된다
- [ ] 버튼 클릭 시 로딩 상태가 표시된다
- [ ] 분석이 완료되면 강점, 개선점, 꼬리질문이 표시된다
- [ ] 한 번 생성된 상세 피드백은 캐싱되어 다음 방문 시 즉시 표시된다

---

## 3. Functional Requirements

### FR-1: 키워드 추출 및 표시

| 항목     | 상세                                                                                         |
| -------- | -------------------------------------------------------------------------------------------- |
| ID       | FR-1                                                                                         |
| 우선순위 | P1                                                                                           |
| 설명     | 사용자 답변에서 핵심 키워드를 추출하여 Badge 형태로 표시                                     |
| 입력     | 질문 내용, 사용자 답변                                                                       |
| 출력     | 3-5개 키워드 배열                                                                            |
| 규칙     | - 답변이 비어있으면 키워드 표시 안함<br>- 키워드는 기술 용어 우선 추출<br>- 중복 키워드 제거 |

### FR-2: 점수 평가

| 항목      | 상세                                                                                   |
| --------- | -------------------------------------------------------------------------------------- |
| ID        | FR-2                                                                                   |
| 우선순위  | P1                                                                                     |
| 설명      | 답변의 품질을 1-5점으로 평가                                                           |
| 입력      | 질문 내용, 카테고리, 사용자 답변                                                       |
| 출력      | 점수 (1-5), 한 줄 요약                                                                 |
| 평가 기준 | - 정확성 (30%)<br>- 완전성 (25%)<br>- 구조 (20%)<br>- 관련성 (15%)<br>- 의사소통 (10%) |

### FR-3: 꼬리질문 생성

| 항목     | 상세                                                                                                        |
| -------- | ----------------------------------------------------------------------------------------------------------- |
| ID       | FR-3                                                                                                        |
| 우선순위 | P1                                                                                                          |
| 설명     | 답변 기반 심화 질문 2-3개 생성                                                                              |
| 입력     | 질문 내용, 카테고리, 사용자 답변                                                                            |
| 출력     | 꼬리질문 배열 (2-3개)                                                                                       |
| 규칙     | - 원 질문과 연관성 유지<br>- 사용자 답변에서 언급하지 않은 심화 내용 질문<br>- 실제 면접에서 나올 법한 질문 |

### FR-4: 강점/개선점 분석

| 항목     | 상세                                                                                            |
| -------- | ----------------------------------------------------------------------------------------------- |
| ID       | FR-4                                                                                            |
| 우선순위 | P2                                                                                              |
| 설명     | 답변의 잘한 점과 개선할 점 분석                                                                 |
| 입력     | 질문 내용, 카테고리, 사용자 답변                                                                |
| 출력     | 강점 배열 (2-3개), 개선점 배열 (2-3개)                                                          |
| 규칙     | - 구체적이고 실행 가능한 피드백<br>- 긍정적 피드백 먼저 제시<br>- 개선점은 건설적인 톤으로 작성 |

### FR-5: 피드백 캐싱

| 항목      | 상세                                         |
| --------- | -------------------------------------------- |
| ID        | FR-5                                         |
| 우선순위  | P1                                           |
| 설명      | 생성된 피드백을 저장하여 재방문 시 즉시 표시 |
| 저장 항목 | 키워드, 점수, 요약, 강점, 개선점, 꼬리질문   |
| 캐시 기간 | 7일 (이후 자동 삭제 또는 재생성)             |
| 갱신 조건 | 답변 수정 시 피드백도 재생성                 |

### FR-6: 피드백 UI 토글

| 항목       | 상세                              |
| ---------- | --------------------------------- |
| ID         | FR-6                              |
| 우선순위   | P1                                |
| 설명       | 피드백 영역 접기/펼치기 기능      |
| 기본 상태  | 접힌 상태 (Quick Feedback만 표시) |
| 펼침 상태  | 전체 상세 피드백 표시             |
| 애니메이션 | 부드러운 높이 전환 (300ms)        |

---

## 4. Non-Functional Requirements

### NFR-1: 응답 속도

| 지표                                | 목표                                            |
| ----------------------------------- | ----------------------------------------------- |
| Quick Feedback (키워드, 점수, 요약) | 사용자가 페이지 진입 시 즉시 표시 (캐싱된 경우) |
| 상세 피드백 생성                    | 요청 후 3초 이내 완료                           |
| 페이지 전체 로드                    | 2초 이내 (피드백 포함)                          |

### NFR-2: 비용 효율성

| 지표             | 목표                    |
| ---------------- | ----------------------- |
| 답변당 평균 비용 | 기존 대비 70% 이상 절감 |
| 월간 운영 비용   | 1,000답변 기준 $1 이하  |

### NFR-3: 사용성

| 지표          | 목표                                  |
| ------------- | ------------------------------------- |
| 모바일 반응형 | 320px ~ 1440px 화면 지원              |
| 접근성        | WCAG 2.1 AA 수준                      |
| 로딩 상태     | 스켈레톤 UI 또는 로딩 인디케이터 표시 |

### NFR-4: 안정성

| 지표              | 목표                                               |
| ----------------- | -------------------------------------------------- |
| AI 서비스 장애 시 | 피드백 없이 기존 Q&A만 표시 (graceful degradation) |
| 타임아웃 처리     | 10초 후 실패 메시지 및 재시도 옵션 표시            |

---

## 5. Success Criteria

| ID   | 기준                                       | 측정 방법                               |
| ---- | ------------------------------------------ | --------------------------------------- |
| SC-1 | 사용자의 80% 이상이 피드백 기능을 사용한다 | 피드백 표시 로그 분석                   |
| SC-2 | 상세 피드백 요청률이 30% 이상이다          | 상세 피드백 API 호출 횟수 / 총 페이지뷰 |
| SC-3 | 피드백 응답 시간이 3초 이내를 유지한다     | API 응답 시간 모니터링                  |
| SC-4 | 운영 비용이 기존 대비 70% 이상 절감된다    | 월간 Claude API 비용 비교               |
| SC-5 | 사용자 만족도가 4.0/5.0 이상이다           | 인앱 피드백 설문 (선택적)               |

---

## 6. User Scenarios & Testing

### Scenario 1: 첫 방문자 피드백 확인

**Preconditions**: 사용자가 면접 세션을 완료하고 아카이브에 저장함

**Steps**:

1. 사용자가 아카이브 목록에서 세션을 선택한다
2. 상세 페이지가 로드된다
3. 각 질문-답변 카드에 Quick Feedback이 표시된다 (키워드, 점수, 요약)
4. 사용자가 특정 답변의 "펼치기" 버튼을 클릭한다
5. 상세 피드백 영역이 펼쳐지고 "상세 분석 요청" 버튼이 표시된다
6. 사용자가 버튼을 클릭한다
7. 로딩 인디케이터가 표시된다
8. 3초 이내에 강점, 개선점, 꼬리질문이 표시된다

**Expected Result**: 사용자가 자신의 답변에 대한 종합적인 AI 피드백을 확인할 수 있다

### Scenario 2: 재방문자 캐싱된 피드백 확인

**Preconditions**: 사용자가 이전에 상세 피드백을 생성함

**Steps**:

1. 사용자가 아카이브 상세 페이지에 재접속한다
2. Quick Feedback이 즉시 표시된다
3. 사용자가 "펼치기" 버튼을 클릭한다
4. 캐싱된 상세 피드백이 즉시 표시된다 (로딩 없음)

**Expected Result**: 이전에 생성된 피드백이 캐시에서 즉시 로드된다

### Scenario 3: 답변 없는 질문

**Preconditions**: 사용자가 일부 질문에 답변하지 않음

**Steps**:

1. 사용자가 아카이브 상세 페이지에 접속한다
2. 답변이 있는 질문에는 피드백이 표시된다
3. 답변이 없는 질문에는 "답변이 작성되지 않았습니다" 메시지만 표시된다
4. 피드백 영역이 표시되지 않는다

**Expected Result**: 답변이 없는 질문에는 피드백 UI가 표시되지 않는다

### Scenario 4: 모바일 화면에서 피드백 확인

**Preconditions**: 사용자가 모바일 기기에서 접속

**Steps**:

1. 사용자가 320px 너비 화면에서 아카이브 상세 페이지에 접속한다
2. 질문-답변 카드가 세로 레이아웃으로 표시된다
3. 키워드 Badge가 줄바꿈되어 여러 줄로 표시된다
4. 피드백 토글 버튼이 쉽게 터치 가능한 크기로 표시된다
5. 상세 피드백도 모바일 레이아웃에 맞게 표시된다

**Expected Result**: 모바일에서도 피드백 기능이 정상 동작한다

---

## 7. Key Entities

### AnswerFeedback

| 필드                | 타입          | 설명                  |
| ------------------- | ------------- | --------------------- |
| id                  | UUID          | 고유 식별자           |
| answer_id           | UUID          | 연결된 답변 ID (FK)   |
| keywords            | String[]      | 추출된 키워드 배열    |
| quick_score         | Integer (1-5) | 빠른 평가 점수        |
| summary             | String        | 한 줄 요약 코멘트     |
| strengths           | String[]      | 잘한 점 목록          |
| improvements        | String[]      | 개선점 목록           |
| follow_up_questions | String[]      | 꼬리질문 목록         |
| detailed_feedback   | String        | 종합 상세 피드백      |
| created_at          | DateTime      | 생성 시각             |
| detail_generated_at | DateTime      | 상세 피드백 생성 시각 |

### 엔티티 관계

```
Answer (1) ←── (0..1) AnswerFeedback
```

- 하나의 Answer는 최대 하나의 AnswerFeedback을 가질 수 있다
- AnswerFeedback은 반드시 하나의 Answer에 연결된다

---

## 8. Scope & Boundaries

### In Scope

- 아카이브 상세 페이지 (`/archive/[id]`) 피드백 UI
- Quick Feedback 자동 생성 (답변 제출 시)
- 상세 피드백 온디맨드 생성
- 피드백 캐싱 및 조회
- 모바일 반응형 디자인

### Out of Scope

- 실시간 면접 중 피드백 (별도 기능)
- 팀 스페이스 피드백 공유
- 피드백 수정/삭제 기능
- 피드백 기반 통계/리포트
- 다른 사용자와 피드백 비교

---

## 9. Assumptions

1. **AI 모델 가용성**: Claude API가 안정적으로 작동한다고 가정
2. **피드백 품질**: AI가 생성한 피드백이 대체로 유용하고 정확하다고 가정
3. **사용자 행동**: 사용자가 아카이브 페이지를 정기적으로 방문하여 복습한다고 가정
4. **답변 품질**: 사용자가 최소 한 문장 이상의 의미 있는 답변을 작성한다고 가정
5. **비용 모델**: 하이브리드 전략(Haiku + Sonnet)으로 비용을 70% 이상 절감할 수 있다고 가정

---

## 10. Dependencies

| 의존성             | 유형        | 설명                        |
| ------------------ | ----------- | --------------------------- |
| Claude API         | 외부 서비스 | AI 피드백 생성에 필요       |
| Supabase           | 인프라      | 피드백 데이터 저장          |
| 기존 Answer 테이블 | 데이터      | 피드백이 참조할 답변 데이터 |
| Framer Motion      | 라이브러리  | 애니메이션 효과             |

---

## Implementation Notes

> Auto-updated by `/task-done`

### Status: Implemented

### Implementation Date: 2026-02-05

### Changes Made:

- **DB 스키마**: `answer_feedback` 테이블 생성 (키워드 분석 컬럼 포함)
- **API 엔드포인트**: GET/POST 피드백 조회/생성 (quick, detail, full)
- **UI 컴포넌트**: FeedbackSection, KeywordAnalysis, StrengthsImprovements, FollowUpQuestions
- **토큰 최적화**: Haiku + Sonnet 하이브리드 전략 적용

### Deviations from Spec:

- **원클릭 전체 피드백**: US-6(상세 피드백 요청)이 US-5(접기/펼치기)와 통합됨 - 한 번 클릭으로 전체 피드백 로드
- **키워드 분석 UI 강화**: 단순 키워드 Badge 대신 기대/언급/누락 키워드 구분 표시 추가

### Verification:

- [x] US-1: 답변 키워드 확인 - 구현 완료 (KeywordAnalysis 컴포넌트)
- [x] US-2: 답변 점수 확인 - 구현 완료 (ScoreSummary)
- [x] US-3: 꼬리질문 확인 - 구현 완료 (FollowUpQuestions 컴포넌트)
- [x] US-4: 강점/개선점 확인 - 구현 완료 (StrengthsImprovements 컴포넌트)
- [x] US-5: 피드백 접기/펼치기 - 구현 완료 (FeedbackSection with Framer Motion)
- [x] US-6: 상세 피드백 요청 - 원클릭으로 통합됨

---

## Revision History

| 버전 | 날짜       | 변경 내용                            | 작성자 |
| ---- | ---------- | ------------------------------------ | ------ |
| 1.0  | 2026-02-05 | 초기 스펙 작성                       | Claude |
| 1.1  | 2026-02-05 | 구현 완료, Implementation Notes 추가 | Claude |
